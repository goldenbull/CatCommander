<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:CatCommander.ViewModels"
             mc:Ignorable="d"
             d:DesignWidth="800" d:DesignHeight="600"
             x:Class="CatCommander.View.ItemsBrowser"
             x:DataType="vm:ItemsBrowserViewModel">
    <Grid>
        <!-- Main content -->
        <DockPanel>
            <!-- Path dropdown/editor at the top -->
            <Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto">
                <AutoCompleteBox Grid.Column="0"
                                 Text="{Binding CurrentPath, Mode=TwoWay}"
                                 ItemsSource="{Binding PathHistory}"
                                 HorizontalAlignment="Stretch"
                                 MinHeight="24"
                                 Watermark="Enter folder path...">
                </AutoCompleteBox>

                <Button Grid.Column="1"
                        Width="30"
                        Height="24"
                        x:Name="HistoryButton">
                    <PathIcon Data="M 0,0 L 10,0 L 5,7 Z" />
                    <Button.Flyout>
                        <Flyout Placement="BottomEdgeAlignedLeft">
                            <Border MinWidth="300" MaxHeight="400">
                                <ListBox ItemsSource="{Binding PathHistory}"
                                         SelectedItem="{Binding CurrentPath, Mode=TwoWay}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" />
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </Grid>

            <!-- status bar -->
            <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Spacing="4">
                <TextBlock Text="Ready" VerticalAlignment="Center" />
                <Separator Width="1" Height="20" VerticalAlignment="Center" />
                <TextBlock Text="Selected:" VerticalAlignment="Center" />
                <TextBlock Text="{Binding SelectedCount}" VerticalAlignment="Center" />
                <TextBlock Text="files" VerticalAlignment="Center" />
            </StackPanel>

            <!-- TreeDataGrid for file listing -->
            <TreeDataGrid Source="{Binding FileItems}"
                          AutoDragDropRows="False"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          ShowColumnHeaders="True"
                          FontSize="12">
                <TreeDataGrid.Styles>
                    <Style Selector="TreeDataGridRow">
                        <Setter Property="MinHeight" Value="12" />
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0" />
                    </Style>
                    <Style Selector="TreeDataGridTextCell">
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0" />
                    </Style>
                </TreeDataGrid.Styles>
            </TreeDataGrid>
        </DockPanel>

        <!-- Filter popup overlay -->
        <Border HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                Margin="0,0,0,30"
                IsVisible="{Binding IsFilterVisible}"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12,8"
                BoxShadow="0 4 16 2 #40000000"
                MinWidth="400">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <TextBlock Grid.Column="0"
                           Text="Filter:"
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"
                           FontWeight="SemiBold" />
                <TextBox Grid.Column="1"
                         x:Name="FilterTextBox"
                         Text="{Binding FilterText, Mode=TwoWay}"
                         Watermark="Type to filter files..."
                         VerticalAlignment="Center"
                         MinWidth="250"
                         MinHeight="28"
                         BorderThickness="1" />
                <Button Grid.Column="2"
                        Content="âœ•"
                        Click="OnClearFilterClick"
                        Width="28"
                        Height="28"
                        Margin="8,0,0,0"
                        ToolTip.Tip="Clear filter (Esc)" />
            </Grid>
        </Border>
    </Grid>
</UserControl>