<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:CatCommander.ViewModels"
             mc:Ignorable="d"
             d:DesignWidth="800" d:DesignHeight="600"
             x:Class="CatCommander.View.ItemBrowser"
             x:DataType="vm:ItemBrowserViewModel">
    <DockPanel>
        <!-- Path dropdown/editor at the top -->
        <Grid DockPanel.Dock="Top" ColumnDefinitions="Auto,*,Auto">
            <!-- show folder tree from root to current folder -->
            <Button Grid.Column="0"
                    Margin="2 0"
                    Padding="0"
                    Width="24"
                    Height="24"
                    MinHeight="0">
                <Image Source="/Images/treeview_32x32.png"></Image>
                <Button.Flyout>
                    <Flyout Placement="BottomEdgeAlignedRight">
                        <Border MinWidth="300" MaxHeight="400">
                            <TreeView ItemsSource="{Binding PathHistory}"></TreeView>
                        </Border>
                    </Flyout>
                </Button.Flyout>
            </Button>

            <!-- textbox for current folder path -->
            <TextBox Grid.Column="1"
                     Text="{Binding RootPath, Mode=TwoWay}"
                     Height="24"
                     MinHeight="0"
                     Watermark="Enter folder path...">
            </TextBox>

            <Button Grid.Column="2"
                    Margin="2 0"
                    Padding="0"
                    Width="24"
                    Height="24"
                    MinHeight="0"
                    x:Name="HistoryButton">
                <PathIcon Data="{StaticResource SemiIconHistory}" />
                <Button.Flyout>
                    <Flyout Placement="BottomEdgeAlignedLeft">
                        <Border MinWidth="300" MaxHeight="400">
                            <ListBox ItemsSource="{Binding PathHistory}"
                                     SelectedItem="{Binding RootPath, Mode=TwoWay}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" />
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Border>
                    </Flyout>
                </Button.Flyout>
            </Button>
        </Grid>

        <!-- status bar -->
        <DockPanel DockPanel.Dock="Bottom" LastChildFill="False">
            <TextBlock DockPanel.Dock="Left" Text="{Binding StatusText}" />
            <TextBox DockPanel.Dock="Right" Width="200" Height="24" MinHeight="0"
                     x:Name="tbFilter" Text="{Binding FilterText, Mode=TwoWay}" />
        </DockPanel>

        <!-- TreeDataGrid for file listing -->
        <TreeDataGrid x:Name="grid"
                      Source="{Binding VisibleItemsSource}"
                      AutoDragDropRows="False"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      ShowColumnHeaders="True"
                      FontSize="12"
                      BorderThickness="1"
                      BorderBrush="Black"
                      >
            <TreeDataGrid.Styles>
                <Style Selector="TreeDataGridRow">
                    <Setter Property="MinHeight" Value="12" />
                    <Setter Property="Padding" Value="0" />
                    <Setter Property="Margin" Value="0" />
                </Style>
                <Style Selector="TreeDataGridTextCell">
                    <Setter Property="Padding" Value="2 0" />
                    <Setter Property="Margin" Value="0" />
                </Style>
            </TreeDataGrid.Styles>
        </TreeDataGrid>
    </DockPanel>
</UserControl>